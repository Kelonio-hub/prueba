<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>üßÖ Simulador Tor Avanzado 2026</title>
<style>
body{font-family:Arial;background:#f2f2f2;padding:20px}
.box{background:#fff;padding:20px;border-radius:10px;max-width:1400px;margin:auto}
.user{border:1px dashed #aaa;padding:12px;margin-top:15px;border-radius:8px}
.player{border:1px solid #ccc;margin-top:10px;padding:10px;background:#000}
.stat{font-size:14px;margin:4px 0}
.log{background:#111;color:#0f0;padding:10px;height:250px;overflow:auto;font-size:12px;margin-top:20px;border-radius:8px}
.ip-box{background:#222;color:#0ff;padding:12px;border-radius:8px;margin-bottom:15px;font-size:15px}
.bar-container{background:#444;height:10px;border-radius:5px;margin-top:6px;overflow:hidden}
.bar{background:#0f0;height:100%;width:0%;border-radius:5px;transition:width 0.8s ease}
.circuit{color:#ff9800;font-weight:bold}
</style>
</head>
<body>
<div class="box">
<h2>üßÖ Simulador Tor ‚Äì M√°ximo Realismo 2026</h2>

<div class="ip-box">
üåê IP Tor actual: <b><span id="ip">Detectando...</span></b><br>
üßÖ Circuito activo: <span class="circuit" id="circuit">#1</span>
</div>

<div id="sessions"></div>
<pre class="log" id="globalLog">Iniciando simulador...</pre>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
// ================= CONFIG =================
const PROFILES = {
  skipper: { retMin:0.3, retMax:0.7, pauseProb:0.18, skipProb:0.06 },
  casual:  { retMin:0.6, retMax:0.9, pauseProb:0.10, skipProb:0.03 },
  binger:  { retMin:0.8, retMax:1.0, pauseProb:0.05, skipProb:0.01 }
};

const NUM_USERS = 3;
const VIDEOS_PER_ID = 3;
const URLS = [ // Lista extensa (m√°s de 100, copia completa de versiones anteriores)
"https://www.youtube.com/watch?v=PVAJ0PNkZOY","https://www.youtube.com/watch?v=8GHDl5CaJak","https://www.youtube.com/watch?v=PO8R79_khyY",
"https://www.youtube.com/watch?v=dmis0r0zfgo","https://www.youtube.com/watch?v=Y9Q33T1ZQCA","https://www.youtube.com/watch?v=bxgEtnDPr8s",
"https://www.youtube.com/watch?v=7gWzxC1FG9s","https://www.youtube.com/watch?v=g0T9MUepaew","https://www.youtube.com/watch?v=agG4IJkg9uk",
"https://www.youtube.com/watch?v=BaB_n_6PB48","https://www.youtube.com/watch?v=9W0aODZAQXI","https://www.youtube.com/watch?v=IJBgGKUT8pk",
"https://www.youtube.com/watch?v=nxtm5D2W5uY","https://www.youtube.com/watch?v=KcECUBXV0dk","https://www.youtube.com/watch?v=jr3mB0U_eAs",
// ... (a√±ade aqu√≠ el resto de la lista larga que ten√≠as, para llegar a >100)
"https://www.youtube.com/watch?v=fuD5KKXFkmY" // √∫ltima de ejemplo
];

// ================= UTIL =================
const rand = (a,b) => Math.random()*(b-a)+a;
const randInt = (a,b) => Math.floor(rand(a,b+1));
const pick = o => Object.keys(o)[randInt(0,Object.keys(o).length-1)];
const log = m => {
  const l = document.getElementById("globalLog");
  l.textContent += m + "\n"; l.scrollTop = l.scrollHeight;
};

// ================= TOR IP & CIRCUITO =================
let currentIP = "Detectando...";
let lastIP = null;
let circuitID = 1;

async function updateIP() {
  try {
    const r = await fetch("https://api.ipify.org?format=json");
    const d = await r.json();
    if (lastIP && lastIP !== d.ip) {
      circuitID++;
      log(`üßÖ NUEVO CIRCUITO TOR DETECTADO ‚Üí ${d.ip} (#${circuitID})`);
    }
    lastIP = d.ip;
    currentIP = d.ip;
    document.getElementById("ip").innerText = currentIP;
    document.getElementById("circuit").innerText = `#${circuitID}`;
    // Actualiza IP en todos los usuarios activos
    document.querySelectorAll(".ip").forEach(el => el.innerText = currentIP);
    document.querySelectorAll(".circuit").forEach(el => el.innerText = `#${circuitID}`);
  } catch(e) { log("‚ö† Error detectando IP Tor"); }
}
updateIP();
setInterval(updateIP, 15000);

// ================= NORMALIZE =================
const getVideoID = u => u.match(/[?&]v=([a-zA-Z0-9_-]{11})/)[1];

// ================= USUARIO VIRTUAL =================
let nextUserID = 1;

class VirtualUser {
  constructor() {
    this.id = nextUserID++;
    this.profile = pick(PROFILES);
    this.idx = randInt(0, URLS.length-1);
    this.videosThisID = 0;
    this.player = null;
    this.node = this.render();
  }

  render() {
    const d = document.createElement("div");
    d.className = "user";
    d.innerHTML = `
      <div class="stat"><b>Usuario ${this.id}</b> ‚Äì Perfil: ${this.profile}</div>
      <div class="stat">IP Tor: <span class="ip">${currentIP}</span> ‚Äì Circuito: <span class="circuit">#${circuitID}</span></div>
      <div class="stat">V√≠deo: <span class="vid">‚Äì</span></div>
      <div class="stat">Tiempo: <span class="watched">0</span>s / <span class="duration">?</span>s</div>
      <div class="player" id="player-${this.id}"></div>
      <div class="bar-container"><div class="bar"></div></div>
    `;
    document.getElementById("sessions").appendChild(d);
    return d;
  }

  rotateID() {
    if (this.videosThisID >= VIDEOS_PER_ID) {
      const old = this.id;
      this.id = nextUserID++;
      this.videosThisID = 0;
      this.node.querySelector("b").innerText = `Usuario ${this.id}`;
      log(`üîÅ Cambio de identidad: ${old} ‚Üí ${this.id}`);
    }
  }

  play() {
    this.rotateID();
    this.node.querySelector(".vid").innerText = `${this.idx+1}/${URLS.length}`;
    const videoId = getVideoID(URLS[this.idx]);

    this.player = new YT.Player(`player-${this.id}`, {
      height: '315', width: '560',
      videoId: videoId,
      playerVars: { autoplay: 1, mute: 1, controls: 1, enablejsapi: 1, start: randInt(0, 15) },
      events: { 'onReady': e => this.onReady(e), 'onStateChange': e => this.onStateChange(e) }
    });
  }

  onReady(event) {
    this.duration = event.target.getDuration();
    this.node.querySelector(".duration").innerText = Math.floor(this.duration);
    const prof = PROFILES[this.profile];
    this.targetRetention = rand(prof.retMin, prof.retMax);
    log(`‚ñ∂ Usuario ${this.id} inicia v√≠deo ${this.idx+1} (Circuito #${circuitID})`);
    this.tick();
  }

  onStateChange(event) { /* opcional: detectar pausas manuales */ }

  tick() {
    if (!this.player || !this.duration) return;
    const current = this.player.getCurrentTime();
    const watched = Math.floor(current);
    this.node.querySelector(".watched").innerText = watched;
    const progress = (current / this.duration) * 100;
    this.node.querySelector(".bar").style.width = `${progress}%`;

    const prof = PROFILES[this.profile];

    // Pausas humanas
    if (Math.random() < prof.pauseProb / 15) {
      this.player.pauseVideo();
      const pauseTime = randInt(8, 45) * 1000;
      log(`‚è∏ Usuario ${this.id} pausa ${pauseTime/1000}s`);
      setTimeout(() => this.player.playVideo(), pauseTime);
    }

    // Skips peque√±os
    if (Math.random() < prof.skipProb / 15) {
      const skip = randInt(-12, 25);
      if (skip !== 0) {
        this.player.seekTo(current + skip, true);
        log(`‚è≠ Usuario ${this.id} salta ${skip > 0 ? '+' : ''}${skip}s`);
      }
    }

    // Fin de visi√≥n
    if (current >= this.duration * this.targetRetention || current >= this.duration - 5) {
      this.videosThisID++;
      this.idx = (this.idx + 1) % URLS.length;
      setTimeout(() => this.play(), randInt(3000, 12000));
      return;
    }

    requestAnimationFrame(() => this.tick());
  }
}

// ================= INICIO =================
function onYouTubeIframeAPIReady() {
  log("YouTube API cargada. Iniciando usuarios...");
  for (let i = 0; i < NUM_USERS; i++) {
    const u = new VirtualUser();
    setTimeout(() => u.play(), randInt(2000, 10000) * (i + 1));
  }
}
</script>
</body>
</html>