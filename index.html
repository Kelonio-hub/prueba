<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo Biblioteca Escolar - Chatbot IA</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Solo estilos para splash (compatibles con tu CSS) */
        #splash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f4f4f4; /* Mismo fondo que tu body para transición suave */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }
        #splash.hidden {
            opacity: 0;
            pointer-events: none;
        }
        #splash img {
            max-width: 200px;
            max-height: 200px;
            margin-bottom: 20px;
        }
        #splash h2 {
            font-size: 2em;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff; /* Coincide con tu color de botón/header */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-top: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash">
        <img src="https://raw.githubusercontent.com/Kelonio-hub/prueba/main/logo%20biblioteca.png" alt="Logo Biblioteca">
        <h2>¡Bienvenidos a la Biblioteca Hipatia!</h2>
        <div class="loader"></div>
        <p style="margin-top: 10px; color: #666;">Cargando...</p>
    </div>

    <header>
        <h1>Catálogo de la Biblioteca Escolar Carpe Diem, Fuenlabrada</h1>
        <p>Busca libros por título, autor, ISBN o categoría, o pregunta al chatbot IA.</p>
    </header>

    <main>
        <!-- Sección de Búsqueda de Catálogo -->
        <section id="busqueda">
            <h2>Buscar Libros</h2>
            <input type="text" id="buscarInput" placeholder="Busca por título, autor, ISBN o categoría..." onkeypress="if(event.key === 'Enter') buscarLibros()">
            <button onclick="buscarLibros()">Buscar</button>
            <div id="resultados"></div>
        </section>

        <!-- Sección de Chatbot -->
        <section id="chatbot">
            <h2>Chatbot IA</h2>
            <p>Pregunta sobre libros, recomendaciones o la biblioteca.</p>
            <div id="chatMensajes"></div>
            <input type="text" id="chatInput" placeholder="Escribe tu mensaje...">
            <button onclick="enviarMensaje()">Enviar</button>
        </section>
    </main>

    <script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
    </script>

    <script src="script.js"></script>

    <script>
        // Ocultar splash después de 7 segundos (seamless con tu CSS)
        setTimeout(function() {
            const splash = document.getElementById('splash');
            splash.classList.add('hidden');
            // Remover del DOM después de la transición para optimizar
            setTimeout(function() {
                splash.remove();
            }, 500);
        }, 7000);
    </script>
</body>
</html>